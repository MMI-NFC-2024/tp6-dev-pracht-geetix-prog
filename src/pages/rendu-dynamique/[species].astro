---
import Layout from "../../layouts/Layout.astro";
import PlotFigure from "../../components/PlotFigure.astro";
import * as Plot from "@observablehq/plot";
import penguins from "../../assets/penguins.json";

export const prerender = false;

const { species } = Astro.params;

const filteredPenguins = penguins.filter(
    (penguin) => penguin.species === species,
);

const allSpecies = [...new Set(penguins.map((p) => p.species))];

const plotOptions = {
    grid: true,
    marks: [
        Plot.dot(filteredPenguins, {
            x: "culmen_length_mm",
            y: "culmen_depth_mm",
            fill: "steelblue",
            r: 4,
            fillOpacity: 0.7,
        }),
    ],
    x: {
        label: "Longueur du bec (mm)",
    },
    y: {
        label: "Profondeur du bec (mm)",
    },
    title: `Relation Longueur vs Profondeur du bec - ${species}`,
};
---

<Layout>
    <div class="max-w-6xl mx-auto p-6">
        <div class="mb-6">
            <a
                href="/rendu-dynamique/"
                class="inline-flex items-center text-blue-600 hover:text-blue-800 underline hover:no-underline transition-colors duration-200 mb-4"
            >
                <span class="mr-2">←</span>
                Retour à la liste des espèces
            </a>
        </div>

        <h1 class="text-3xl font-bold text-gray-800 mb-2">
            Pingouins {species}
        </h1>

        <p class="text-lg text-gray-600 mb-6">
            {filteredPenguins.length} pingouin(s) de l'espèce {species}
        </p>

        {
            filteredPenguins.length === 0 ? (
                <div class="bg-red-50 border border-red-200 rounded-lg p-6 text-center">
                    <h2 class="text-xl font-semibold text-red-800 mb-2">
                        Aucun pingouin trouvé
                    </h2>
                    <p class="text-red-600">
                        L'espèce "{species}" n'existe pas dans nos données.
                    </p>
                </div>
            ) : (
                <div class="bg-white rounded-lg shadow-sm border p-6">
                    <PlotFigure options={plotOptions} />
                </div>
            )
        }

        <div class="mt-8">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">
                Autres espèces :
            </h3>
            <div class="flex flex-wrap gap-3">
                {
                    allSpecies
                        .filter((s) => s !== species)
                        .map((speciesName) => (
                            <a
                                href={`/rendu-dynamique/${speciesName}`}
                                class="bg-blue-100 hover:bg-blue-200 text-blue-800 px-4 py-2 rounded-lg transition-colors duration-200 font-medium"
                            >
                                {speciesName}
                            </a>
                        ))
                }
            </div>
        </div>
    </div>
</Layout>
